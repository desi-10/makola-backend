model Store {
  id                    String                 @id @default(cuid())
  name                  String
  description           String?
  image                 String?
  organizationId        String
  categories            Category[]
  products              Product[]
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  deletedAt             DateTime?
  isActive              Boolean                @default(true)
  organization          Organization           @relation(fields: [organizationId], references: [id])
  members               StoreMember[]
  roles                 StoreRole[]
  settings              StoreSetting[]
  history               StoreHistory[]
  inventory             Inventory[]            @relation("StoreInventory")
  orders                Order[]
  payments              Payment[]
  invoices              Invoice[]
  discounts             Discount[]
  coupons               Coupon[]
  campaigns             Campaign[]
  flashSales            FlashSale[]
  newsletters           Newsletter[]
  newsletterSubscribers NewsletterSubscriber[]
  expenses              Expense[]
  invites               Invite[]
  carts                 Cart[]
  brands                Brand[]
  variantInventories    VariantInventory[]     @relation("StoreVariantInventory")
  productTags           ProductTag[]

  @@unique([name, organizationId])
  @@index([id, organizationId])
  @@index([id, organizationId, isActive])
  @@map("store")
}

model StoreMember {
  id        String    @id @default(cuid())
  userId    String
  storeId   String
  roleId    String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  isActive  Boolean   @default(true)
  user      User      @relation(fields: [userId], references: [id])
  store     Store     @relation(fields: [storeId], references: [id])
  role      StoreRole @relation(fields: [roleId], references: [id])

  @@unique([userId, storeId]) // prevent duplicate membership
  @@index([id, userId, storeId])
  @@index([id, userId, storeId, isActive])
  @@map("store_members")
}

model StoreRole {
  id              String                @id @default(cuid())
  name            String
  description     String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  storeId         String
  deletedAt       DateTime?
  isActive        Boolean               @default(true)
  store           Store                 @relation(fields: [storeId], references: [id])
  rolePermissions StoreRolePermission[]
  members         StoreMember[]

  @@unique([name, storeId])
  @@index([id, storeId])
  @@index([id, storeId, isActive])
  @@map("store_roles")
}

model StoreRolePermission {
  id           String     @id @default(cuid())
  roleId       String
  permissionId String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  deletedAt    DateTime?
  isActive     Boolean    @default(true)
  role         StoreRole  @relation(fields: [roleId], references: [id])
  permission   Permission @relation(fields: [permissionId], references: [id])

  @@map("store_role_permissions")
}

model StoreSetting {
  id        String   @id @default(cuid())
  storeId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  store Store @relation(fields: [storeId], references: [id])

  @@map("store_settings")
}

// Assumed Permission model
model Permission {
  id          String   @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  storeRolePermissions StoreRolePermission[]

  @@map("permissions")
}

model StoreHistory {
  id          String    @id @default(cuid())
  storeId     String
  userId      String
  action      String
  description String?
  reason      String?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  meta        Json?

  store Store @relation(fields: [storeId], references: [id])
  user  User  @relation(fields: [userId], references: [id])

  @@map("store_history")
}
